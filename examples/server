#!/usr/bin/env php
<?php
require __DIR__ . '/../vendor/autoload.php';

Eloquent\Asplode\Asplode::install();

use Icecave\Stump\Logger;
use PhpAmqpLib\Channel\AMQPChannel;
use Skewd\Common\Amqp\BasicConnectionFactory;
use Skewd\Server\Application\Application;
use Skewd\Server\Application\ModularApplication;
use Skewd\Server\Application\Module;
use Skewd\Server\Process\TickingProcess;

class MyModule implements Module
{
    public function name()
    {
        return 'my-module';
    }

    public function initialize(Application $application, AMQPChannel $channel)
    {
        // if (rand(0, 1))
        //     throw new \Exception('OH SHIT!');
    }

    public function shutdown()
    {
        // if (rand(0, 1))
        //     throw new \Exception('OH SHIT!');
    }

    public function tick()
    {
        echo '.';
        usleep(500);
    }
}

// -----------------------------------------------------------------------------

$logger = new Logger;
$app = new ModularApplication(new BasicConnectionFactory, $logger);
$app->add(new MyModule);

$process = new TickingProcess($app, $logger);
$process->start();

